var countryMapping=[];

countryMapping.push({name:'AF',code:'AFGHANISTAN'});
countryMapping.push({name:'ZA',code:'AFRIQUE DU SUD'});
countryMapping.push({name:'AX',code:'ALAND, ILES'});
countryMapping.push({name:'AL',code:'ALBANIE'});
countryMapping.push({name:'DZ',code:'ALGERIE'});
countryMapping.push({name:'DE',code:'ALLEMAGNE'});
countryMapping.push({name:'AD',code:'ANDORRE'});
countryMapping.push({name:'AO',code:'ANGOLA'});
countryMapping.push({name:'AI',code:'ANGUILLA'});
countryMapping.push({name:'AQ',code:'ANTARCTIQUE'});
countryMapping.push({name:'AG',code:'ANTIGUA ET BARBUDA'});
countryMapping.push({name:'SA',code:'ARABIE SAOUDITE'});
countryMapping.push({name:'AR',code:'ARGENTINE'});
countryMapping.push({name:'AM',code:'ARMENIE'});
countryMapping.push({name:'AW',code:'ARUBA'});
countryMapping.push({name:'AU',code:'AUSTRALIE'});
countryMapping.push({name:'AT',code:'AUTRICHE'});
countryMapping.push({name:'AZ',code:'AZERBAIDJAN'});
countryMapping.push({name:'BS',code:'BAHAMAS'});
countryMapping.push({name:'BH',code:'BAHREIN'});
countryMapping.push({name:'BD',code:'BANGLADESH'});
countryMapping.push({name:'BB',code:'BARBADE'});
countryMapping.push({name:'BY',code:'BELARUS'});
countryMapping.push({name:'BE',code:'BELGIQUE'});
countryMapping.push({name:'BZ',code:'BELIZE'});
countryMapping.push({name:'BJ',code:'BENIN'});
countryMapping.push({name:'BM',code:'BERMUDES'});
countryMapping.push({name:'BT',code:'BHOUTAN'});
countryMapping.push({code:'BOLIVIE',name:'BO'});
countryMapping.push({name:'BA',code:'BOSNIE-HERZEGOVINE'});
countryMapping.push({name:'BW',code:'BOTSWANA'});
countryMapping.push({name:'BV',code:'BOUVET, ILE'});
countryMapping.push({name:'BR',code:'BRESIL'});
countryMapping.push({name:'BN',code:'BRUNEI DARUSSALAM'});
countryMapping.push({name:'BG',code:'BULGARIE'});
countryMapping.push({name:'BF',code:'BURKINA FASO'});
countryMapping.push({name:'BI',code:'BURUNDI'});
countryMapping.push({name:'KY',code:'CAIMANES, ILES'});
countryMapping.push({name:'KH',code:'CAMBODGE'});
countryMapping.push({name:'CM',code:'CAMEROUN'});
countryMapping.push({name:'CA',code:'CANADA'});
countryMapping.push({name:'CV',code:'CAP-VERT'});
countryMapping.push({name:'CF',code:'CENTRAFRICAINE, REPUBLIQUE'});
countryMapping.push({name:'CL',code:'CHILI'});
countryMapping.push({name:'CN',code:'CHINE'});
countryMapping.push({name:'CX',code:'CHRISTMAS, ILE'});
countryMapping.push({name:'CY',code:'CHYPRE'});
countryMapping.push({name:'CC',code:'COCOS (KEELING), ILES'});
countryMapping.push({name:'CO',code:'COLOMBIE'});
countryMapping.push({name:'KM',code:'COMORES'});
countryMapping.push({name:'CG',code:'CONGO'});
countryMapping.push({name:'CD',code:'CONGO, LA REPUBLIQUE DEMOCRATIQUE DU'});
countryMapping.push({name:'CK',code:'COOK, ILES'});
countryMapping.push({name:'KR',code:'COREE, REPUBLIQUE DE'});
countryMapping.push({name:'KP',code:'COREE, REPUBLIQUE POPULAIRE DEMOCRATIQUE DE'});
countryMapping.push({name:'CR',code:'COSTA RICA'});
countryMapping.push({name:'CI',code:'COTE D IVOIRE'});
countryMapping.push({name:'HR',code:'CROATIE'});
countryMapping.push({name:'CU',code:'CUBA'});
countryMapping.push({name:'CW',code:'CURACAO'});
countryMapping.push({name:'DK',code:'DANEMARK'});
countryMapping.push({name:'DJ',code:'DJIBOUTI'});
countryMapping.push({name:'DO',code:'DOMINICAINE, REPUBLIQUE'});
countryMapping.push({name:'DM',code:'DOMINIQUE'});
countryMapping.push({name:'EG',code:'EGYPTE'});
countryMapping.push({name:'SV',code:'EL SALVADOR'});
countryMapping.push({name:'AE',code:'EMIRATS ARABES UNIS'});
countryMapping.push({name:'EC',code:'EQUATEUR'});
countryMapping.push({name:'ER',code:'ERYTHREE'});
countryMapping.push({name:'ES',code:'ESPAGNE'});
countryMapping.push({name:'EE',code:'ESTONIE'});
countryMapping.push({name:'US',code:'ETATS-UNIS'});
countryMapping.push({name:'ET',code:'ETHIOPIE'});
countryMapping.push({name:'FK',code:'FALKLAND, ILES (MALVINAS)'});
countryMapping.push({name:'FO',code:'FEROE, ILES'});
countryMapping.push({name:'FJ',code:'FIDJI'});
countryMapping.push({name:'FI',code:'FINLANDE'});
countryMapping.push({name:'FR',code:'FRANCE'});
countryMapping.push({name:'GA',code:'GABON'});
countryMapping.push({name:'GM',code:'GAMBIE'});
countryMapping.push({name:'GE',code:'GEORGIE'});
countryMapping.push({name:'GS',code:'GEORGIE DU SUD ET LES ILES SANDWICH DU SUD'});
countryMapping.push({name:'GH',code:'GHANA'});
countryMapping.push({name:'GI',code:'GIBRALTAR'});
countryMapping.push({name:'GR',code:'GRECE'});
countryMapping.push({name:'GD',code:'GRENADE'});
countryMapping.push({name:'GL',code:'GROENLAND'});
countryMapping.push({name:'GP',code:'GUADELOUPE'});
countryMapping.push({name:'GU',code:'GUAM'});
countryMapping.push({name:'GT',code:'GUATEMALA'});
countryMapping.push({name:'GG',code:'GUERNESEY'});
countryMapping.push({name:'GN',code:'GUINEE'});
countryMapping.push({name:'GW',code:'GUINEE-BISSAU'});
countryMapping.push({name:'GQ',code:'GUINEE EQUATORIALE'});
countryMapping.push({name:'GY',code:'GUYANA'});
countryMapping.push({name:'GF',code:'GUYANE FRANCAISE'});
countryMapping.push({name:'HT',code:'HAITI'});
countryMapping.push({name:'HM',code:'HEARD, ILE ET MCDONALD, ILES'});
countryMapping.push({name:'HN',code:'HONDURAS'});
countryMapping.push({name:'HK',code:'HONG KONG'});
countryMapping.push({name:'HU',code:'HONGRIE'});
countryMapping.push({name:'IM',code:'ILE DE MAN'});
countryMapping.push({name:'UM',code:'ILES MINEURES ELOIGNEES DES ETATS-UNIS'});
countryMapping.push({name:'VG',code:'ILES VIERGES BRITANNIQUES'});
countryMapping.push({name:'VI',code:'ILES VIERGES DES ETATS-UNIS'});
countryMapping.push({name:'IN',code:'INDE'});
countryMapping.push({name:'ID',code:'INDONESIE'});
countryMapping.push({name:'IR',code:'IRAN, REPUBLIQUE ISLAMIQUE D'});
countryMapping.push({name:'IQ',code:'IRAQ'});
countryMapping.push({name:'IE',code:'IRLANDE'});
countryMapping.push({name:'IS',code:'ISLANDE'});
countryMapping.push({name:'IL',code:'ISRAEL'});
countryMapping.push({name:'IT',code:'ITALIE'});
countryMapping.push({name:'JM',code:'JAMAIQUE'});
countryMapping.push({name:'JP',code:'JAPON'});
countryMapping.push({name:'JE',code:'JERSEY'});
countryMapping.push({name:'JO',code:'JORDANIE'});
countryMapping.push({name:'KZ',code:'KAZAKHSTAN'});
countryMapping.push({name:'KE',code:'KENYA'});
countryMapping.push({name:'KG',code:'KIRGHIZISTAN'});
countryMapping.push({name:'KI',code:'KIRIBATI'});
countryMapping.push({name:'KW',code:'KOWEIT'});
countryMapping.push({name:'LA',code:'LAO, REPUBLIQUE DEMOCRATIQUE POPULAIRE'});
countryMapping.push({name:'LS',code:'LESOTHO'});
countryMapping.push({name:'LV',code:'LETTONIE'});
countryMapping.push({name:'LB',code:'LIBAN'});
countryMapping.push({name:'LR',code:'LIBERIA'});
countryMapping.push({name:'LY',code:'LIBYENNE, JAMAHIRIYA ARABE'});
countryMapping.push({name:'LI',code:'LIECHTENSTEIN'});
countryMapping.push({name:'LT',code:'LITUANIE'});
countryMapping.push({name:'LU',code:'LUXEMBOURG'});
countryMapping.push({name:'MO',code:'MACAO'});
countryMapping.push({name:'MK',code:'MACEDOINE, L EX-REPUBLIQUE YOUGOSLAVE DE'});
countryMapping.push({name:'MG',code:'MADAGASCAR'});
countryMapping.push({name:'MY',code:'MALAISIE'});
countryMapping.push({name:'MW',code:'MALAWI'});
countryMapping.push({name:'MV',code:'MALDIVES'});
countryMapping.push({name:'ML',code:'MALI'});
countryMapping.push({name:'MT',code:'MALTE'});
countryMapping.push({name:'MP',code:'MARIANNES DU NORD, ILES'});
countryMapping.push({name:'MA',code:'MAROC'});
countryMapping.push({name:'MH',code:'MARSHALL, ILES'});
countryMapping.push({name:'MQ',code:'MARTINIQUE'});
countryMapping.push({name:'MU',code:'MAURICE'});
countryMapping.push({name:'MR',code:'MAURITANIE'});
countryMapping.push({name:'YT',code:'MAYOTTE'});
countryMapping.push({name:'MX',code:'MEXIQUE'});
countryMapping.push({name:'FM',code:'MICRONESIE, ETATS FEDERES DE'});
countryMapping.push({name:'MD',code:'MOLDOVA, REPUBLIQUE DE'});
countryMapping.push({name:'MC',code:'MONACO'});
countryMapping.push({name:'MN',code:'MONGOLIE'});
countryMapping.push({name:'ME',code:'MONTENEGRO'});
countryMapping.push({name:'MS',code:'MONTSERRAT'});
countryMapping.push({name:'MZ',code:'MOZAMBIQUE'});
countryMapping.push({name:'MM',code:'MYANMAR'});
countryMapping.push({name:'NA',code:'NAMIBIE'});
countryMapping.push({name:'NR',code:'NAURU'});
countryMapping.push({name:'NP',code:'NEPAL'});
countryMapping.push({name:'NI',code:'NICARAGUA'});
countryMapping.push({name:'NE',code:'NIGER'});
countryMapping.push({name:'NG',code:'NIGERIA'});
countryMapping.push({name:'NU',code:'NIUE'});
countryMapping.push({name:'NF',code:'NORFOLK, ILE'});
countryMapping.push({name:'NO',code:'NORVEGE'});
countryMapping.push({name:'NC',code:'NOUVELLE-CALEDONIE'});
countryMapping.push({name:'NZ',code:'NOUVELLE-ZELANDE'});
countryMapping.push({name:'IO',code:'OCEAN INDIEN, TERRITOIRE BRITANNIQUE DE L'});
countryMapping.push({name:'OM',code:'OMAN'});
countryMapping.push({name:'UG',code:'OUGANDA'});
countryMapping.push({name:'UZ',code:'OUZBEKISTAN'});
countryMapping.push({name:'PK',code:'PAKISTAN'});
countryMapping.push({name:'PW',code:'PALAOS'});
countryMapping.push({name:'PS',code:'PALESTINIEN OCCUPE, TERRITOIRE'});
countryMapping.push({name:'PA',code:'PANAMA'});
countryMapping.push({name:'PG',code:'PAPOUASIE-NOUVELLE-GUINEE'});
countryMapping.push({name:'PY',code:'PARAGUAY'});
countryMapping.push({name:'NL',code:'PAYS-BAS'});
countryMapping.push({name:'PE',code:'PEROU'});
countryMapping.push({name:'PH',code:'PHILIPPINES'});
countryMapping.push({name:'PN',code:'PITCAIRN'});
countryMapping.push({name:'PL',code:'POLOGNE'});
countryMapping.push({name:'PF',code:'POLYNESIE FRANCAISE'});
countryMapping.push({name:'PR',code:'PORTO RICO'});
countryMapping.push({name:'PT',code:'PORTUGAL'});
countryMapping.push({name:'QA',code:'QATAR'});
countryMapping.push({name:'RE',code:'REUNION'});
countryMapping.push({name:'RO',code:'ROUMANIE'});
countryMapping.push({name:'GB',code:'ROYAUME-UNI'});
countryMapping.push({name:'RU',code:'RUSSIE, FEDERATION DE'});
countryMapping.push({name:'RW',code:'RWANDA'});
countryMapping.push({name:'EH',code:'SAHARA OCCIDENTAL'});
countryMapping.push({name:'BL',code:'SAINT-BARTHELEMY'});
countryMapping.push({name:'SH',code:'SAINTE-HELENE, ASCENSION ET TRISTAN DA CUNHA'});
countryMapping.push({name:'LC',code:'SAINTE-LUCIE'});
countryMapping.push({name:'KN',code:'SAINT-KITTS-ET-NEVIS'});
countryMapping.push({name:'SM',code:'SAINT-MARIN'});
countryMapping.push({name:'MF',code:'SAINT-MARTIN (PARTIE FRANCAISE)'});
countryMapping.push({name:'SX',code:'SAINT-MARTIN (PARTIE NEERLANDAISE)'});
countryMapping.push({name:'PM',code:'SAINT-PIERRE-ET-MIQUELON'});
countryMapping.push({name:'VA',code:'SAINT-SIEGE (ETAT DE LA CITE DU VATICAN)'});
countryMapping.push({name:'VC',code:'SAINT-VINCENT-ET-LES GRENADINES'});
countryMapping.push({name:'SB',code:'SALOMON, ILES'});
countryMapping.push({name:'WS',code:'SAMOA'});
countryMapping.push({name:'AS',code:'SAMOA AMERICAINES'});
countryMapping.push({name:'ST',code:'SAO TOME-ET-PRINCIPE'});
countryMapping.push({name:'SN',code:'SENEGAL'});
countryMapping.push({name:'RS',code:'SERBIE'});
countryMapping.push({name:'SC',code:'SEYCHELLES'});
countryMapping.push({name:'SL',code:'SIERRA LEONE'});
countryMapping.push({name:'SG',code:'SINGAPOUR'});
countryMapping.push({name:'SK',code:'SLOVAQUIE'});
countryMapping.push({name:'SI',code:'SLOVENIE'});
countryMapping.push({name:'SO',code:'SOMALIE'});
countryMapping.push({name:'SD',code:'SOUDAN'});
countryMapping.push({name:'LK',code:'SRI LANKA'});
countryMapping.push({name:'SE',code:'SUEDE'});
countryMapping.push({name:'CH',code:'SUISSE'});
countryMapping.push({name:'SR',code:'SURINAME'});
countryMapping.push({name:'SJ',code:'SVALBARD ET ILE JAN MAYEN'});
countryMapping.push({name:'SZ',code:'SWAZILAND'});
countryMapping.push({name:'SY',code:'SYRIENNE, REPUBLIQUE ARABE'});
countryMapping.push({name:'TJ',code:'TADJIKISTAN'});
countryMapping.push({name:'TW',code:'TAIWAN, PROVINCE DE CHINE'});
countryMapping.push({name:'TZ',code:'TANZANIE, REPUBLIQUE-UNIE DE'});
countryMapping.push({name:'TD',code:'TCHAD'});
countryMapping.push({name:'CZ',code:'TCHEQUE, REPUBLIQUE'});
countryMapping.push({name:'TF',code:'TERRES AUSTRALES FRANCAISES'});
countryMapping.push({name:'TH',code:'THAILANDE'});
countryMapping.push({name:'TL',code:'TIMOR-LESTE'});
countryMapping.push({name:'TG',code:'TOGO'});
countryMapping.push({name:'TK',code:'TOKELAU'});
countryMapping.push({name:'TO',code:'TONGA'});
countryMapping.push({name:'TT',code:'TRINITE-ET-TOBAGO'});
countryMapping.push({name:'TN',code:'TUNISIE'});
countryMapping.push({name:'TM',code:'TURKMENISTAN'});
countryMapping.push({name:'TC',code:'TURKS ET CAIQUES, ILES'});
countryMapping.push({name:'TR',code:'TURQUIE'});
countryMapping.push({name:'TV',code:'TUVALU'});
countryMapping.push({name:'UA',code:'UKRAINE'});
countryMapping.push({name:'UY',code:'URUGUAY'});
countryMapping.push({name:'VU',code:'VANUATU'});
countryMapping.push({name:'vo',code:'VATICAN, ETAT DE LA CITE DU ir SAINT-SIEGE'});
countryMapping.push({name:'VE',code:'VENEZUELA, REPUBLIQUE BOLIVARIENNE DU'});
countryMapping.push({name:'VN',code:'VIET NAM'});
countryMapping.push({name:'WF',code:'WALLIS ET FUTUNA'});
countryMapping.push({name:'YE',code:'YEMEN'});
countryMapping.push({name:'ZM',code:'ZAMBIE'});
countryMapping.push({name:'ZW',code:'ZIMBABWE'});



angular.module('delr1', ['ngDialog'])
	.controller('GalleryCtrl', function($scope,$rootScope,$http,$timeout,ngDialog) {
		$scope.inprogress=0;
		$scope.comment=0;
		$scope.countryMapping=countryMapping;
		
		$rootScope.$on('ngDialog.opened', function (e, $dialog) {
                        $('#inputcomment').focus();

                });

		$scope.alert=function(msg) {
			alert(msg);
		}
		
		$scope.managePublic = function(action) {
			 $http.post('/api/v1/setpublic/'+$scope.gallery.gallery.id,{alphanum_act:action})
				.success(function(res) {
					$scope.pubinfo=res;
					console.log($scope.pubinfo);
				});
		}
		
		$scope.displayCountry = function() {
			ngDialog.open({ template: 'countryselection',className: 'ngdialog-theme-default',scope:$scope });
		}

		$scope.showCom = function (id,index) {
			$scope.currentcommentindex=index;
			$scope.currentcomment=$scope.gallery.photos[index].commentaire;
			$scope.dialogid=ngDialog.open({ template: 'modalid',className: 'ngdialog-theme-default',scope:$scope });
			
		}


		$scope.updateComment = function (index,comment) {
			$http.post('/api/v1/setcom/'+ $scope.gallery.photos[index].id,{str_com:comment})
				.success(function(res) {
					$scope.gallery.photos[index].commentaire=comment;
					ngDialog.close($scope.dialogid);
					});
		}

   	 	$scope.actShowPhoto = function(id) {
	   		$scope.showphoto=true;
			param='';

			$http.get('/api/v1/getgallery/'+id+param)
       				.then(function(res){
          				$scope.gallery = res.data;
					$scope.managePublic('view');
	        		});
	
			$http.get('/api/v1/getgalleryright/'+id+param)
				.then(function(res){
					$scope.rights = res.data;
				});
    		};

		$scope.saveInfo = function() {
			right2send="";
			$scope.inprogress=1;
			for (var i = 0; i < $scope.rights.length; i++) {
				if ($scope.rights[i].selected)
					right2send+=$scope.rights[i].id+"|";
			}
			$http({url:'/api/v1/setgalleryinfo/'+$scope.gallery.gallery.id, 
					data:{str_name:$scope.gallery.gallery.name,date_date:$scope.gallery.gallery.date,str_comment:$scope.gallery.gallery.commentaire,str_right:right2send,str_country:$scope.gallery.gallery.country,str_youtube:$scope.gallery.gallery.youtube}, 
					method:'POST'})
						.success(function(data, status, headers, config) {
							$scope.inprogress=2;
							$timeout(function () { $scope.inprogress=0 }, 3000);
  						})
						.error(function(data, status, headers, config) {
							alert(data.error);
							$scope.inprogress=0;
  						});

		};

                $scope.actShowPage = function(page) {
                        if (page<$scope.numGal)
                                $scope.startGal=page;
                        $scope.displayGal();
                };

		$scope.updatesearch = function(val) {
				if (val.length>2){
					$scope.filter=val;
					$scope.startGal=0;
				} else 
					$scope.filter="";
				$scope.displayGal();
		};

		$scope.displayGal = function(){
	                $http.get('/api/v1/listgallery?num_start='+$scope.startGal+'&num_limit='+$scope.galLimit+'&str_search='+$scope.filter)
        	                .then(function(res){
                	        $scope.galleries = res.data.galleries;
				$scope.numGal    = res.data.num;
				
				$scope.link=[];
				i=0;
				
				while(i*$scope.galLimit<$scope.numGal)
				{	
					$scope.link.push({indice:i,selected:(i==$scope.startGal)});
					i+=1;
				}
				console.log($scope.link);
                	});

		}

		$scope.nextPage=function() {

			$scope.startGal+=1;
			if($scope.startGal*$scope.galLimit>$scope.numGal)
				$scope.startGal = $scope.startGal-1;
			$scope.displayGal();
		}

                $scope.previousPage=function() {
                        $scope.startGal-=1;
                        if ($scope.startGal<0)
                                $scope.startGal=0;
                        $scope.displayGal();
                }


		$scope.$on('ngRepeatFinished', function (ngRepeatFinishedEvent) {
			  param="/videos.php?";
			  if (hashgal)
                                param+='alphanum_hash='+hashgal+'/'+$scope.gallery.gallery.id+'&';
			  param+='id_gal='+$scope.gallery.gallery.id;
			  so.addVariable('playlistfile',param);
			  so.addVariable('file',param);
			  so.addVariable('frontcolor','000000');
			  so.addVariable('lightcolor','cc9900');
			  so.addVariable('screencolor','000000');
			  so.addVariable('plugins','grid-1');
			  so.addVariable('dock', 'true');
			  so.addVariable('skin', '/video/skin/classic.zip');

			  so.write('mediaspace');
		});

                $scope.startGal=0;
                $scope.galLimit=30;
                $scope.numGal=0;
                $scope.gallery={};
                $scope.link=[];
                $scope.filter="";
		if (hashgal&&idgal) {

                	$scope.showphoto=true;
			$scope.actShowPhoto(idgal);
		}
		else {
			$scope.showphoto=false;
                	$scope.displayGal();
		}
	})



	.directive('onFinishRenderFilters', function ($timeout) {
		return {
			restrict: 'A',
			link: function (scope, element, attr) {
				if (scope.$last === true) {
					$timeout(function () {
						scope.$emit('ngRepeatFinished');
					});
				}
			}
		}
	});



	
